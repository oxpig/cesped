<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>cesped.utils.angles API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>cesped.utils.angles</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">#Modified from from https://github.com/facebookresearch/pytorch3d/blob/main/pytorch3d/transforms/rotation_conversions.py

import torch

def _axis_angle_rotation(axis: str, angle: torch.Tensor) -&gt; torch.Tensor:
    &#34;&#34;&#34;
    Return the rotation matrices for one of the rotations about an axis
    of which Euler angles describe, for each value of the angle given.

    Args:
        axis: Axis label &#34;X&#34; or &#34;Y or &#34;Z&#34;.
        angle: any shape tensor of Euler angles in radians

    Returns:
        Rotation matrices as tensor of shape (..., 3, 3).
    &#34;&#34;&#34;

    cos = torch.cos(angle)
    sin = torch.sin(angle)
    one = torch.ones_like(angle)
    zero = torch.zeros_like(angle)

    if axis == &#34;X&#34;:
        R_flat = (one, zero, zero, zero, cos, -sin, zero, sin, cos)
    elif axis == &#34;Y&#34;:
        R_flat = (cos, zero, sin, zero, one, zero, -sin, zero, cos)
    elif axis == &#34;Z&#34;:
        R_flat = (cos, -sin, zero, sin, cos, zero, zero, zero, one)
    else:
        raise ValueError(&#34;letter must be either X, Y or Z.&#34;)

    return torch.stack(R_flat, -1).reshape(angle.shape + (3, 3))


def euler_angles_to_matrix(euler_angles: torch.Tensor, convention: str) -&gt; torch.Tensor:
    &#34;&#34;&#34;
    Convert rotations given as Euler angles in radians to rotation matrices.

    Args:
        euler_angles: Euler angles in radians as tensor of shape (..., 3).
        convention: Convention string of three uppercase letters from
            {&#34;X&#34;, &#34;Y&#34;, and &#34;Z&#34;}.

    Returns:
        Rotation matrices as tensor of shape (..., 3, 3).
    &#34;&#34;&#34;
    if euler_angles.dim() == 0 or euler_angles.shape[-1] != 3:
        raise ValueError(&#34;Invalid input euler angles.&#34;)
    if len(convention) != 3:
        raise ValueError(&#34;Convention must have 3 letters.&#34;)
    if convention[1] in (convention[0], convention[2]):
        raise ValueError(f&#34;Invalid convention {convention}.&#34;)
    for letter in convention:
        if letter not in (&#34;X&#34;, &#34;Y&#34;, &#34;Z&#34;):
            raise ValueError(f&#34;Invalid letter {letter} in convention string.&#34;)
    matrices = [
        _axis_angle_rotation(c, e)
        for c, e in zip(convention, torch.unbind(euler_angles, -1))
    ]
    # return functools.reduce(torch.matmul, matrices)
    return torch.matmul(torch.matmul(matrices[0], matrices[1]), matrices[2])


def _angle_from_tan(
    axis: str, other_axis: str, data, horizontal: bool, tait_bryan: bool
) -&gt; torch.Tensor:
    &#34;&#34;&#34;
    Extract the first or third Euler angle from the two members of
    the matrix which are positive constant times its sine and cosine.

    Args:
        axis: Axis label &#34;X&#34; or &#34;Y or &#34;Z&#34; for the angle we are finding.
        other_axis: Axis label &#34;X&#34; or &#34;Y or &#34;Z&#34; for the middle axis in the
            convention.
        data: Rotation matrices as tensor of shape (..., 3, 3).
        horizontal: Whether we are looking for the angle for the third axis,
            which means the relevant entries are in the same row of the
            rotation matrix. If not, they are in the same column.
        tait_bryan: Whether the first and third axes in the convention differ.

    Returns:
        Euler Angles in radians for each matrix in data as a tensor
        of shape (...).
    &#34;&#34;&#34;

    i1, i2 = {&#34;X&#34;: (2, 1), &#34;Y&#34;: (0, 2), &#34;Z&#34;: (1, 0)}[axis]
    if horizontal:
        i2, i1 = i1, i2
    even = (axis + other_axis) in [&#34;XY&#34;, &#34;YZ&#34;, &#34;ZX&#34;]
    if horizontal == even:
        return torch.atan2(data[..., i1], data[..., i2])
    if tait_bryan:
        return torch.atan2(-data[..., i2], data[..., i1])
    return torch.atan2(data[..., i2], -data[..., i1])


def _index_from_letter(letter: str) -&gt; int:
    if letter == &#34;X&#34;:
        return 0
    if letter == &#34;Y&#34;:
        return 1
    if letter == &#34;Z&#34;:
        return 2
    raise ValueError(&#34;letter must be either X, Y or Z.&#34;)


def matrix_to_euler_angles(matrix: torch.Tensor, convention: str) -&gt; torch.Tensor:
    &#34;&#34;&#34;
    Convert rotations given as rotation matrices to Euler angles in radians.

    Args:
        matrix: Rotation matrices as tensor of shape (..., 3, 3).
        convention: Convention string of three uppercase letters.

    Returns:
        Euler angles in radians as tensor of shape (..., 3).
    &#34;&#34;&#34;
    if len(convention) != 3:
        raise ValueError(&#34;Convention must have 3 letters.&#34;)
    if convention[1] in (convention[0], convention[2]):
        raise ValueError(f&#34;Invalid convention {convention}.&#34;)
    for letter in convention:
        if letter not in (&#34;X&#34;, &#34;Y&#34;, &#34;Z&#34;):
            raise ValueError(f&#34;Invalid letter {letter} in convention string.&#34;)
    if matrix.size(-1) != 3 or matrix.size(-2) != 3:
        raise ValueError(f&#34;Invalid rotation matrix shape {matrix.shape}.&#34;)
    i0 = _index_from_letter(convention[0])
    i2 = _index_from_letter(convention[2])
    tait_bryan = i0 != i2
    if tait_bryan:
        central_angle = torch.asin(
            matrix[..., i0, i2] * (-1.0 if i0 - i2 in [-1, 2] else 1.0)
        )
    else:
        central_angle = torch.acos(matrix[..., i0, i0])

    o = (
        _angle_from_tan(
            convention[0], convention[1], matrix[..., i2], False, tait_bryan
        ),
        central_angle,
        _angle_from_tan(
            convention[2], convention[1], matrix[..., i0, :], True, tait_bryan
        ),
    )
    return torch.stack(o, -1)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="cesped.utils.angles.euler_angles_to_matrix"><code class="name flex">
<span>def <span class="ident">euler_angles_to_matrix</span></span>(<span>euler_angles: torch.Tensor, convention: str) ‑> torch.Tensor</span>
</code></dt>
<dd>
<div class="desc"><p>Convert rotations given as Euler angles in radians to rotation matrices.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>euler_angles</code></strong></dt>
<dd>Euler angles in radians as tensor of shape (&hellip;, 3).</dd>
<dt><strong><code>convention</code></strong></dt>
<dd>Convention string of three uppercase letters from
{"X", "Y", and "Z"}.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>Rotation matrices as tensor of shape (&hellip;, 3, 3).</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def euler_angles_to_matrix(euler_angles: torch.Tensor, convention: str) -&gt; torch.Tensor:
    &#34;&#34;&#34;
    Convert rotations given as Euler angles in radians to rotation matrices.

    Args:
        euler_angles: Euler angles in radians as tensor of shape (..., 3).
        convention: Convention string of three uppercase letters from
            {&#34;X&#34;, &#34;Y&#34;, and &#34;Z&#34;}.

    Returns:
        Rotation matrices as tensor of shape (..., 3, 3).
    &#34;&#34;&#34;
    if euler_angles.dim() == 0 or euler_angles.shape[-1] != 3:
        raise ValueError(&#34;Invalid input euler angles.&#34;)
    if len(convention) != 3:
        raise ValueError(&#34;Convention must have 3 letters.&#34;)
    if convention[1] in (convention[0], convention[2]):
        raise ValueError(f&#34;Invalid convention {convention}.&#34;)
    for letter in convention:
        if letter not in (&#34;X&#34;, &#34;Y&#34;, &#34;Z&#34;):
            raise ValueError(f&#34;Invalid letter {letter} in convention string.&#34;)
    matrices = [
        _axis_angle_rotation(c, e)
        for c, e in zip(convention, torch.unbind(euler_angles, -1))
    ]
    # return functools.reduce(torch.matmul, matrices)
    return torch.matmul(torch.matmul(matrices[0], matrices[1]), matrices[2])</code></pre>
</details>
</dd>
<dt id="cesped.utils.angles.matrix_to_euler_angles"><code class="name flex">
<span>def <span class="ident">matrix_to_euler_angles</span></span>(<span>matrix: torch.Tensor, convention: str) ‑> torch.Tensor</span>
</code></dt>
<dd>
<div class="desc"><p>Convert rotations given as rotation matrices to Euler angles in radians.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>matrix</code></strong></dt>
<dd>Rotation matrices as tensor of shape (&hellip;, 3, 3).</dd>
<dt><strong><code>convention</code></strong></dt>
<dd>Convention string of three uppercase letters.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>Euler angles in radians as tensor of shape (&hellip;, 3).</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def matrix_to_euler_angles(matrix: torch.Tensor, convention: str) -&gt; torch.Tensor:
    &#34;&#34;&#34;
    Convert rotations given as rotation matrices to Euler angles in radians.

    Args:
        matrix: Rotation matrices as tensor of shape (..., 3, 3).
        convention: Convention string of three uppercase letters.

    Returns:
        Euler angles in radians as tensor of shape (..., 3).
    &#34;&#34;&#34;
    if len(convention) != 3:
        raise ValueError(&#34;Convention must have 3 letters.&#34;)
    if convention[1] in (convention[0], convention[2]):
        raise ValueError(f&#34;Invalid convention {convention}.&#34;)
    for letter in convention:
        if letter not in (&#34;X&#34;, &#34;Y&#34;, &#34;Z&#34;):
            raise ValueError(f&#34;Invalid letter {letter} in convention string.&#34;)
    if matrix.size(-1) != 3 or matrix.size(-2) != 3:
        raise ValueError(f&#34;Invalid rotation matrix shape {matrix.shape}.&#34;)
    i0 = _index_from_letter(convention[0])
    i2 = _index_from_letter(convention[2])
    tait_bryan = i0 != i2
    if tait_bryan:
        central_angle = torch.asin(
            matrix[..., i0, i2] * (-1.0 if i0 - i2 in [-1, 2] else 1.0)
        )
    else:
        central_angle = torch.acos(matrix[..., i0, i0])

    o = (
        _angle_from_tan(
            convention[0], convention[1], matrix[..., i2], False, tait_bryan
        ),
        central_angle,
        _angle_from_tan(
            convention[2], convention[1], matrix[..., i0, :], True, tait_bryan
        ),
    )
    return torch.stack(o, -1)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="cesped.utils" href="index.html">cesped.utils</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="cesped.utils.angles.euler_angles_to_matrix" href="#cesped.utils.angles.euler_angles_to_matrix">euler_angles_to_matrix</a></code></li>
<li><code><a title="cesped.utils.angles.matrix_to_euler_angles" href="#cesped.utils.angles.matrix_to_euler_angles">matrix_to_euler_angles</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>